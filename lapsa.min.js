class Lapsa{callbacks={};slideContainer=null;slides=[];currentSlide=-1;buildState=0;tableViewSlidesPerScreen=4;shelfIconPaths=["/icons/up-2.png","/icons/up-1.png","/icons/table.png","/icons/down-1.png","/icons/down-2.png"];permanentShelf=!1;transitionAnimationTime=150;transitionAnimationDistanceFactor=.015;tableViewAnimationTime=600;shelfAnimationTime=275;tableViewEasing="cubic-bezier(.25, 1.0, .5, 1.0)";slideAnimateInEasing="cubic-bezier(.4, 1.0, .7, 1.0)";slideAnimateOutEasing="cubic-bezier(.1, 0.0, .2, 0.0)";shelfAnimateInEasing="cubic-bezier(.4, 1.0, .7, 1.0)";shelfAnimateOutEasing="cubic-bezier(.4, 0.0, .4, 1.0)";windowHeightAnimationFrames=8;resizeOnTableView=!1;appendHTML="";_rootSelector=null;_bottomMarginElement=null;_shelfContainer=null;_slideShelf=null;_shelfMargin=15;_shelfIsOpen=!1;_shelfIsAnimating=!1;_transitionAnimationDistance=0;_startingSlide=0;_numBuilds=[];_currentlyAnimating=!1;_inTableView=!1;_boundFunctions=[null,null,null,null,null];_maxTouches=0;_currentlyTouchDevice=!1;_lastMousemoveEvent=0;_lastWindowHeight=window.innerHeight;_startWindowHeight=window.innerHeight;_windowHeightAnimationFrame=0;_windowHeightAnimationLastTimestamp=-1;_resizeAnimationBound=null;_missedResizeAnimation=!1;constructor(options){this.callbacks=options?.builds??{},this.transitionAnimationTime=options?.transitionAnimationTime??150,this.transitionAnimationDistanceFactor=options?.transitionAnimationDistanceFactor??.015,this.tableViewAnimationTime=options?.tableViewAnimationTime??600,this.shelfAnimationTime=options?.shelfAnimationTime??275,this.resizeOnTableView=options?.resizeOnTableView??!1,this.windowHeightAnimationFrames=options?.windowHeightAnimationFrames??8,this._startingSlide=options?.startingSlide??0,this.tableViewSlidesPerScreen=options?.tableViewSlidesPerScreen??4,this.useShelf=options?.useShelf??!0,this.permanentShelf=options?.permanentShelf??!1,this.shelfIconPaths=options?.shelfIconPaths??"/icons/","string"==typeof this.shelfIconPaths&&(this.shelfIconPaths.length>=1&&"/"!==this.shelfIconPaths[this.shelfIconPaths.length-1]&&(this.shelfIconPaths=`${this.shelfIconPaths}/`),this.shelfIconPaths=[`${this.shelfIconPaths}up-2.png`,`${this.shelfIconPaths}up-1.png`,`${this.shelfIconPaths}table.png`,`${this.shelfIconPaths}down-1.png`,`${this.shelfIconPaths}down-2.png`]),this.slideAnimateInEasing=options?.slideAnimateInEasing??"cubic-bezier(.4, 1.0, .7, 1.0)",this.slideAnimateOutEasing=options?.slideAnimateOutEasing??"cubic-bezier(.1, 0.0, .2, 0.0)",this.shelfAnimateInEasing=options?.shelfAnimateInEasing??"cubic-bezier(.4, 1.0, .7, 1.0)",this.shelfAnimateOutEasing=options?.shelfAnimateOutEasing??"cubic-bezier(.4, 0.0, .4, 1.0)",this.tableViewEasing=options?.tableViewEasing??"cubic-bezier(.25, 1.0, .5, 1.0)",this.appendHTML=options?.appendHTML??"",this._rootSelector=document.querySelector(":root"),this._resizeAnimationBound=this._resizeAnimation.bind(this),this.slideContainer=document.body.querySelector("#lapsa-slide-container"),this.slideContainer.classList.add("lapsa-hover"),this._bottomMarginElement=document.createElement("div"),this._bottomMarginElement.id="lapsa-bottom-margin",this.slideContainer.appendChild(this._bottomMarginElement),this.slides=document.body.querySelectorAll(".slide"),this._numBuilds=new Array(this.slides.length),this.slides.forEach(((element,index)=>{const wrapper=document.createElement("div");wrapper.classList.add("lapsa-slide-wrapper"),wrapper.style.top=window.innerWidth/window.innerHeight>=152/89?`calc(${100*index+2.5} * var(--safe-vh))`:`calc(${100*index} * var(--safe-vh) + (100 * var(--safe-vh) - 55.625vw) / 2)`,this.slideContainer.insertBefore(wrapper,element),wrapper.appendChild(element),0!==element.children.length?element.lastElementChild.insertAdjacentHTML("afterend",this.appendHTML):element.innerHTML=this.appendHTML,element.addEventListener("click",(()=>{this._inTableView&&this.closeTableView(index)}));const builds=element.querySelectorAll(".build, [data-build]");let currentBuild=0;builds.forEach((buildElement=>{let attr=buildElement.getAttribute("data-build");null===attr?(buildElement.setAttribute("data-build",currentBuild),currentBuild++):currentBuild=parseInt(attr)+1,buildElement.classList.remove("build")}));const functionalBuildKeys=Object.keys(this.callbacks?.[element.id]??{});let maxFunctionalBuild=0;functionalBuildKeys.forEach((key=>maxFunctionalBuild=Math.max(maxFunctionalBuild,parseInt(key)+1||0))),this._numBuilds[index]=Math.max(currentBuild,maxFunctionalBuild)})),this._transitionAnimationDistance=window.innerWidth/window.innerHeight>=152/89?window.innerHeight*this.transitionAnimationDistanceFactor*159/82:window.innerWidth*this.transitionAnimationDistanceFactor,this._rootSelector.style.setProperty("--safe-vh",window.innerHeight/100+"px"),this._shelfContainer=document.createElement("div"),this._shelfContainer.id="lapsa-slide-shelf-container",this._shelfContainer.innerHTML=`\n\t\t\t<div id="lapsa-slide-shelf" class="lapsa-hover" style="margin-left: ${this._shelfMargin}px; opacity: 0">\n\t\t\t\t<input type="image" id="lapsa-up-2-button" class="shelf-button" src="${this.shelfIconPaths[0]}">\n\t\t\t\t<input type="image" id="lapsa-up-1-button" class="shelf-button" src="${this.shelfIconPaths[1]}">\n\t\t\t\t<input type="image" id="lapsa-table-button" class="shelf-button" src="${this.shelfIconPaths[2]}">\n\t\t\t\t<input type="image" id="lapsa-down-1-button" class="shelf-button" src="${this.shelfIconPaths[3]}">\n\t\t\t\t<input type="image" id="lapsa-down-2-button" class="shelf-button" src="${this.shelfIconPaths[4]}">\n\t\t\t</div>\n\t\t`,document.body.appendChild(this._shelfContainer),"scrollRestoration"in history&&(history.scrollRestoration="manual"),setTimeout((()=>window.scrollTo(0,0)),10),setTimeout((()=>{this._slideShelf=document.querySelector("#lapsa-slide-shelf"),this.permanentShelf?(this._shelfContainer.classList.add("permanent-shelf"),this.showSlideShelf(this._slideShelf),this._shelfIsAnimating=!1,this._shelfIsOpen=!0):this.hideSlideShelf(this._slideShelf,0),this._shelfContainer.addEventListener("mouseenter",(()=>{this._shelfIsOpen||this.permanentShelf||!this.useShelf||this.showShelf()})),this._shelfContainer.addEventListener("mouseleave",(()=>{this._shelfIsOpen&&!this.permanentShelf&&this.useShelf&&this.hideShelf()})),this._slideShelf.children[0].addEventListener("click",(()=>{this._shelfIsOpen&&!this._shelfIsAnimating&&this.previousSlide(!0)})),this._slideShelf.children[1].addEventListener("click",(()=>{this._shelfIsOpen&&!this._shelfIsAnimating&&this.previousSlide()})),this._slideShelf.children[2].addEventListener("click",(()=>{this._shelfIsOpen&&!this._shelfIsAnimating&&(this._inTableView?this.closeTableView(this.currentSlide):this.openTableView())})),this._slideShelf.children[3].addEventListener("click",(()=>{this._shelfIsOpen&&!this._shelfIsAnimating&&this.nextSlide()})),this._slideShelf.children[4].addEventListener("click",(()=>{this._shelfIsOpen&&!this._shelfIsAnimating&&this.nextSlide(!0)}))}),100),document.documentElement.style.overflowY="hidden",document.body.style.overflowY="hidden",document.body.style.userSelect="none",document.body.style.WebkitUserSelect="none",this._boundFunctions[0]=this._handleKeydownEvent.bind(this),this._boundFunctions[1]=this._handleTouchstartEvent.bind(this),this._boundFunctions[2]=this._handleTouchendEvent.bind(this),this._boundFunctions[3]=this._handleMousemoveEvent.bind(this),this._boundFunctions[4]=this._onResize.bind(this),document.documentElement.addEventListener("keydown",this._boundFunctions[0]),document.documentElement.addEventListener("touchstart",this._boundFunctions[1]),document.documentElement.addEventListener("touchend",this._boundFunctions[2]),document.documentElement.addEventListener("mousemove",this._boundFunctions[3]),window.addEventListener("resize",this._boundFunctions[4]),setTimeout((()=>this.jumpToSlide(this._startingSlide)),500)}exit(){this.slideContainer.remove(),this.slides.forEach((element=>element.remove())),document.documentElement.style.overflowY="visible",document.body.style.overflowY="visible",document.body.style.height="fit-content",document.body.style.userSelect="auto",document.body.style.WebkitUserSelect="auto",document.documentElement.removeEventListener("keydown",this._boundFunctions[0]),document.documentElement.removeEventListener("touchstart",this._boundFunctions[1]),document.documentElement.removeEventListener("touchend",this._boundFunctions[2]),document.documentElement.removeEventListener("mousemove",this._boundFunctions[3]),window.removeEventListener("resize",this._boundFunctions[4])}_onResize(){if(!this._currentlyAnimating)if(this._transitionAnimationDistance=window.innerWidth/window.innerHeight>=152/89?window.innerHeight*this.transitionAnimationDistanceFactor*159/82:window.innerWidth*this.transitionAnimationDistanceFactor,this._inTableView){const bodyRect=document.body.getBoundingClientRect(),slidesPerScreen=bodyRect.width/bodyRect.height>=152/89?1:bodyRect.height/(89*bodyRect.width/152),scale=Math.min(slidesPerScreen/this.tableViewSlidesPerScreen,1),scaledSlidesPerScreen=slidesPerScreen/scale,centerSlide=Math.min(Math.max((scaledSlidesPerScreen-1)/2,this.currentSlide),this.slides.length-1-(scaledSlidesPerScreen-1)/2),translation=bodyRect.width/bodyRect.height>=152/89?`calc(${(8835/89*centerSlide-100*centerSlide)*scale} * var(--safe-vh))`:`calc(${58.125*centerSlide*scale}vw - ${100*centerSlide*scale} * var(--safe-vh))`;this.slides.forEach(((element,index)=>{window.innerWidth/window.innerHeight>=152/89?element.parentNode.style.top=`calc(${5+8835/89*(index-centerSlide)+100*centerSlide} * var(--safe-vh))`:element.parentNode.style.top=`calc(${2.5+58.125*(index-centerSlide)}vw + ${100*centerSlide} * var(--safe-vh))`})),window.innerWidth/window.innerHeight>=152/89?this._bottomMarginElement.style.top=`calc(${5+8835/89*(this.slides.length-centerSlide)+100*centerSlide} * var(--safe-vh))`:this._bottomMarginElement.style.top=`calc(${2.5+58.125*(this.slides.length-centerSlide)}vw + ${100*centerSlide} * var(--safe-vh))`,this.slideContainer.style.transform=`translateY(${translation}) scale(${scale})`,this.resizeOnTableView?(this._startWindowHeight=this._lastWindowHeight,this._windowHeightAnimationFrame=1,window.requestAnimationFrame(this._resizeAnimationBound)):this._missedResizeAnimation=!0}else this._rootSelector.style.setProperty("--safe-vh",window.innerHeight/100+"px"),this.slides.forEach(((element,index)=>element.parentNode.style.top=window.innerWidth/window.innerHeight>=152/89?`calc(${100*index+2.5} * var(--safe-vh))`:`calc(${100*index} * var(--safe-vh) + (100 * var(--safe-vh) - 55.625vw) / 2)`)),this.slideContainer.style.transform=`translateY(calc(${-100*this.currentSlide} * var(--safe-vh))) scale(1)`}_resizeAnimation(timestamp){const timeElapsed=timestamp=this._windowHeightAnimationLastTimestamp;if(this._windowHeightAnimationLastTimestamp=timestamp,0===timeElapsed)return;const t=.5*(1+Math.cos(Math.PI*(this._windowHeightAnimationFrame/this.windowHeightAnimationFrames+1))),newHeight=this._startWindowHeight*(1-t)+window.innerHeight*t;if(this._lastWindowHeight=newHeight,this._rootSelector.style.setProperty("--safe-vh",newHeight/100+"px"),this._inTableView){const slidesPerScreen=window.innerWidth/newHeight>=152/89?1:newHeight/(89*window.innerWidth/152),scale=Math.min(slidesPerScreen/this.tableViewSlidesPerScreen,1),scaledSlidesPerScreen=slidesPerScreen/scale,centerSlide=Math.min(Math.max((scaledSlidesPerScreen-1)/2,this.currentSlide),this.slides.length-1-(scaledSlidesPerScreen-1)/2),translation=window.innerWidth/newHeight>=152/89?`calc(${(8835/89*centerSlide-100*centerSlide)*scale} * var(--safe-vh))`:`calc(${58.125*centerSlide*scale}vw - ${100*centerSlide*scale} * var(--safe-vh))`;this.slideContainer.style.transform=`translateY(${translation}) scale(${scale})`}this._windowHeightAnimationFrame++,this._windowHeightAnimationFrame<=this.windowHeightAnimationFrames&&window.requestAnimationFrame(this._resizeAnimationBound)}nextSlide(skipBuilds=!1){return new Promise((async(resolve,reject)=>{if(this._currentlyAnimating||this._inTableView)resolve();else{if(this._currentlyAnimating=!0,this.currentSlide>=0&&!skipBuilds&&0!==this._numBuilds[this.currentSlide]&&this.buildState!==this._numBuilds[this.currentSlide]){let promises=[];this.slides[this.currentSlide].querySelectorAll(`[data-build="${this.buildState}"]`).forEach((element=>{this.fadeUpIn(element,2*this.transitionAnimationTime),promises.push(new Promise(((resolve,reject)=>setTimeout(resolve,this.transitionAnimationTime))))}));try{promises.push(this.callbacks[this.slides[this.currentSlide].id][this.buildState](this.slides[this.currentSlide],!0))}catch(ex){}return await Promise.all(promises),this.buildState++,void(this._currentlyAnimating=!1)}if(this.currentSlide!==this.slides.length-1){if(await this.fadeUpOut(this.slideContainer,this.transitionAnimationTime),this.currentSlide>=0&&this.buildState!==this._numBuilds[this.currentSlide]){try{await this.callbacks[this.slides[this.currentSlide].id].reset(this.slides[this.currentSlide],!0,0)}catch(ex){}this.slides[this.currentSlide].querySelectorAll("[data-build]").forEach((element=>element.style.opacity=1))}this.currentSlide++,this.buildState=0;try{await this.callbacks[this.slides[this.currentSlide].id].reset(this.slides[this.currentSlide],!0,0)}catch(ex){}this.slides[this.currentSlide].querySelectorAll("[data-build]").forEach((element=>element.style.opacity=0)),this.slideContainer.style.transform=`translateY(calc(${-100*this.currentSlide} * var(--safe-vh))) scale(1)`,await this.fadeUpIn(this.slideContainer,2*this.transitionAnimationTime),this._currentlyAnimating=!1,resolve()}else this._currentlyAnimating=!1}}))}previousSlide(skipBuilds=!1){return new Promise((async(resolve,reject)=>{if(this._currentlyAnimating||this._inTableView)resolve();else{if(this._currentlyAnimating=!0,!skipBuilds&&0!==this._numBuilds[this.currentSlide]&&0!==this.buildState){this.buildState--;let promises=[];this.slides[this.currentSlide].querySelectorAll(`[data-build="${this.buildState}"]`).forEach((element=>promises.push(this.fadeDownOut(element,this.transitionAnimationTime))));try{promises.push(this.callbacks[this.slides[this.currentSlide].id][this.buildState](this.slides[this.currentSlide],!1))}catch(ex){}return await Promise.all(promises),void(this._currentlyAnimating=!1)}if(0!==this.currentSlide&&this.currentSlide!==this.slides.length){if(await this.fadeDownOut(this.slideContainer,this.transitionAnimationTime),this.buildState!==this._numBuilds[this.currentSlide]){try{await this.callbacks[this.slides[this.currentSlide].id].reset(this.slides[this.currentSlide],!1,0)}catch(ex){}this.slides[this.currentSlide].querySelectorAll("[data-build]").forEach((element=>element.style.opacity=1))}this.currentSlide--,this.buildState=this._numBuilds[this.currentSlide];try{await this.callbacks[this.slides[this.currentSlide].id].reset(this.slides[this.currentSlide],!1,0)}catch(ex){}this.slides[this.currentSlide].querySelectorAll("[data-build]").forEach((element=>element.style.opacity=1)),this.slideContainer.style.transform=`translateY(calc(${-100*this.currentSlide} * var(--safe-vh))) scale(1)`,await this.fadeDownIn(this.slideContainer,2*this.transitionAnimationTime),this._currentlyAnimating=!1,resolve()}else this._currentlyAnimating=!1}}))}jumpToSlide(index){return new Promise((async(resolve,reject)=>{if(this._currentlyAnimating||this._inTableView)return void resolve();if(this._currentlyAnimating=!0,index<0||index>=this.slides.length||index===this.currentSlide)return this._currentlyAnimating=!1,void resolve();const forwardAnimation=index>this.currentSlide;if(forwardAnimation?await this.fadeUpOut(this.slideContainer,this.transitionAnimationTime):await this.fadeDownOut(this.slideContainer,this.transitionAnimationTime),-1!==this.currentSlide&&this.buildState!==this._numBuilds[this.currentSlide]){try{await this.callbacks[this.slides[this.currentSlide].id].reset(this.slides[this.currentSlide],!1,0)}catch(ex){}this.slides[this.currentSlide].querySelectorAll("[data-build]").forEach((element=>element.style.opacity=1))}this.currentSlide=index,this.buildState=0;try{await this.callbacks[this.slides[this.currentSlide].id].reset(this.slides[this.currentSlide],!0,0)}catch(ex){}this.slides[this.currentSlide].querySelectorAll("[data-build]").forEach((element=>element.style.opacity=0)),this.slideContainer.style.transform=`translateY(calc(${-100*this.currentSlide} * var(--safe-vh))) scale(1)`,forwardAnimation?await this.fadeUpIn(this.slideContainer,2*this.transitionAnimationTime):await this.fadeDownIn(this.slideContainer,2*this.transitionAnimationTime),this._currentlyAnimating=!1,resolve()}))}openTableView(duration=this.tableViewAnimationTime){return new Promise(((resolve,reject)=>{if(this._inTableView||this._currentlyAnimating)return void resolve();this._currentlyAnimating=!0,this._currentlyTouchDevice&&this.hideShelf(),document.body.style.overflowY="visible",document.body.style.position="relative",this.slideContainer.style.overflowY="visible";const bodyRect=document.body.getBoundingClientRect(),slidesPerScreen=bodyRect.width/bodyRect.height>=152/89?1:bodyRect.height/(89*bodyRect.width/152),scale=Math.min(slidesPerScreen/this.tableViewSlidesPerScreen,1),scaledSlidesPerScreen=slidesPerScreen/scale,centerSlide=Math.min(Math.max((scaledSlidesPerScreen-1)/2,this.currentSlide),this.slides.length-1-(scaledSlidesPerScreen-1)/2);this.slideContainer.style.transformOrigin=`center calc(${100*this.currentSlide+50} * var(--safe-vh))`;const translation=bodyRect.width/bodyRect.height>=152/89?`calc(${(8835/89*centerSlide-100*centerSlide)*scale} * var(--safe-vh))`:`calc(${58.125*centerSlide*scale}vw - ${100*centerSlide*scale} * var(--safe-vh))`;if(this.slideContainer.style.transition=`transform ${duration}ms ${this.tableViewEasing}`,this.slideContainer.style.transform=bodyRect.width/bodyRect.height>=152/89?`translateY(calc(${58.125*(this.currentSlide-centerSlide)*152/89*scale-100*this.currentSlide} * var(--safe-vh))) scale(${scale})`:`translateY(calc(${58.125*(this.currentSlide-centerSlide)*scale}vw - ${100*this.currentSlide} * var(--safe-vh))) scale(${scale})`,this.slides.forEach(((element,index)=>{element.parentNode.style.transition=`top ${duration}ms ${this.tableViewEasing}`,bodyRect.width/bodyRect.height>=152/89?element.parentNode.style.top=`calc(${8835/89*(index-this.currentSlide)+100*this.currentSlide+2.5} * var(--safe-vh))`:element.parentNode.style.top=`calc(${58.125*(index-this.currentSlide)}vw + ${100*this.currentSlide} * var(--safe-vh) + (100 * var(--safe-vh) - 55.625vw) / 2)`})),this.buildState!==this._numBuilds[this.currentSlide]){const builds=this.slides[this.currentSlide].querySelectorAll("[data-build]"),oldTransitionStyles=new Array(builds.length);builds.forEach(((element,index)=>{oldTransitionStyles[index]=element.style.transition,element.style.transition=`opacity ${duration/2}ms ${this.slideAnimateOutEasing}`,element.style.opacity=1}));try{this.callbacks[this.slides[this.currentSlide].id].reset(this.slides[this.currentSlide],!1,duration/2)}catch(ex){}setTimeout((()=>{builds.forEach(((element,index)=>element.style.transition=oldTransitionStyles[index]))}),duration/2)}setTimeout((()=>{const correctTop=this.slides[this.currentSlide].getBoundingClientRect().top;this.slideContainer.style.transition="",this.slides.forEach(((element,index)=>{element.parentNode.style.transition="",bodyRect.width/bodyRect.height>=152/89?element.parentNode.style.top=`calc(${5+8835/89*(index-centerSlide)+100*centerSlide} * var(--safe-vh))`:element.parentNode.style.top=`calc(${2.5+58.125*(index-centerSlide)}vw + ${100*centerSlide} * var(--safe-vh))`})),window.innerWidth/window.innerHeight>=152/89?this._bottomMarginElement.style.top=`calc(${5+8835/89*(this.slides.length-centerSlide)+100*centerSlide} * var(--safe-vh))`:this._bottomMarginElement.style.top=`calc(${2.5+58.125*(this.slides.length-centerSlide)}vw + ${100*centerSlide} * var(--safe-vh))`,this.slideContainer.style.transformOrigin="center top",this.slideContainer.style.transform=`translateY(${translation}) scale(${scale})`,document.documentElement.style.overflowY="visible";const newTop=this.slides[this.currentSlide].getBoundingClientRect().top;window.scrollTo(0,newTop-correctTop),this._currentlyAnimating=!1,this._inTableView=!0,this._missedResizeAnimation=!1,this.slideContainer.classList.add("lapsa-table-view"),resolve()}),duration)}))}closeTableView(selection,duration=this.tableViewAnimationTime){return new Promise(((resolve,reject)=>{if(!this._inTableView||this._currentlyAnimating)return void resolve();this._currentlyAnimating=!0,this.currentSlide=selection,this.slideContainer.classList.remove("lapsa-table-view");const bodyRect=document.body.getBoundingClientRect(),slidesPerScreen=bodyRect.width/bodyRect.height>=152/89?1:bodyRect.height/(89*bodyRect.width/152),scale=Math.min(slidesPerScreen/this.tableViewSlidesPerScreen,1),centerSlide=Math.min(Math.max(1.25,this.currentSlide),this.slides.length-2.25),correctTop=this.slides[0].getBoundingClientRect().top;document.documentElement.style.overflowY="hidden",document.body.style.overflowY="hidden",this.slideContainer.style.transformOrigin=`center calc(${100*centerSlide+50} * var(--safe-vh))`,this.slides.forEach(((element,index)=>{bodyRect.width/bodyRect.height>=152/89?element.parentNode.style.top=`calc(${8835/89*(index-this.currentSlide)+100*this.currentSlide+2.5} * var(--safe-vh))`:element.parentNode.style.top=`calc(${58.125*(index-this.currentSlide)}vw + ${100*this.currentSlide} * var(--safe-vh) + (100 * var(--safe-vh) - 55.625vw) / 2)`})),this._bottomMarginElement.style.top=0,this.slideContainer.style.transform=`translateY(0) scale(${scale})`,window.scrollTo(0,0);const scroll=correctTop-this.slides[0].getBoundingClientRect().top;this.slideContainer.style.transform=`translateY(${scroll}px) scale(${scale})`;const builds=this.slides[this.currentSlide].querySelectorAll("[data-build]"),oldTransitionStyles=new Array(builds.length);builds.forEach(((element,index)=>{oldTransitionStyles[index]=element.style.transition,element.style.transition=`opacity ${duration/3}ms ${this.slideAnimateInEasing}`,element.style.opacity=0}));try{this.callbacks[this.slides[this.currentSlide].id].reset(this.slides[this.currentSlide],!0,duration/3)}catch(ex){}setTimeout((()=>{builds.forEach(((element,index)=>element.style.transition=oldTransitionStyles[index]))}),duration/3),this.slideContainer.style.transition="",this.slideContainer.style.transform=`translateY(${scroll}px) scale(${scale})`,setTimeout((()=>{this.slideContainer.style.transition=`transform ${duration}ms ${this.tableViewEasing}`,this.slideContainer.style.transform=`translateY(calc(${-100*this.currentSlide} * var(--safe-vh))) scale(1)`,this.slides.forEach(((element,index)=>{element.parentNode.style.transition=`top ${duration}ms ${this.tableViewEasing}`,element.parentNode.style.top=window.innerWidth/window.innerHeight>=152/89?`calc(${100*index+2.5} * var(--safe-vh))`:`calc(${100*index} * var(--safe-vh) + (100 * var(--safe-vh) - 55.625vw) / 2)`})),setTimeout((()=>{builds.forEach(((element,index)=>element.style.transition=oldTransitionStyles[index])),this.buildState=0,this.slideContainer.style.transition="",this.slides.forEach((element=>element.parentNode.style.transition="")),this._currentlyAnimating=!1,this._inTableView=!1,document.body.style.position="fixed",this._missedResizeAnimation&&(this._startWindowHeight=this._lastWindowHeight,this._windowHeightAnimationFrame=1,window.requestAnimationFrame(this._resizeAnimationBound)),resolve()}),duration)}),0)}))}async showShelf(){this.permanentShelf||(this._shelfIsOpen=!0,this._shelfIsAnimating=!0,this._slideShelf.style.display="",this._slideShelf.parentNode.style.paddingRight="100px",await this.showSlideShelf(this._slideShelf),this._shelfIsAnimating=!1)}async hideShelf(){this.permanentShelf||(this._shelfIsOpen=!1,this._shelfIsAnimating=!0,this._slideShelf.parentNode.style.paddingRight="0",await this.hideSlideShelf(this._slideShelf),this._shelfIsAnimating=!1)}showSlideShelf(element,duration=this.shelfAnimationTime){return new Promise(((resolve,reject)=>{const oldTransitionStyle=element.style.transition;element.style.transition=`margin-left ${duration}ms ${this.shelfAnimateInEasing}, opacity ${duration}ms ${this.shelfAnimateInEasing}`,element.style.marginLeft=`${this._shelfMargin}px`,element.style.opacity=1,setTimeout((()=>{element.style.transition=oldTransitionStyle,resolve()}),duration)}))}hideSlideShelf(element,duration=this.shelfAnimationTime){return new Promise(((resolve,reject)=>{const oldTransitionStyle=element.style.transition;element.style.transition=`margin-left ${duration}ms ${this.shelfAnimateOutEasing}, opacity ${duration}ms ${this.shelfAnimateOutEasing}`,element.style.marginLeft=-this._shelfMargin+"px",element.style.opacity=0,setTimeout((()=>{element.style.transition=oldTransitionStyle,resolve()}),duration)}))}_handleKeydownEvent(e){39===e.keyCode||40===e.keyCode||32===e.keyCode||13===e.keyCode?this.nextSlide():37!==e.keyCode&&38!==e.keyCode||this.previousSlide()}_handleTouchstartEvent(e){this._maxTouches=Math.max(this._maxTouches,e.touches.length),this._currentlyTouchDevice=!0,this._slideShelf.classList.remove("lapsa-hover"),this.slideContainer.classList.remove("lapsa-hover")}_handleTouchendEvent(e){2===this._maxTouches?this.nextSlide():3!==this._maxTouches||this._shelfIsAnimating||(this._shelfIsOpen?this.hideShelf():this.showShelf()),this._maxTouches=0,setTimeout((()=>this._slideShelf.classList.remove("lapsa-hover")),50),setTimeout((()=>this.slideContainer.classList.remove("lapsa-hover")),50)}_handleMousemoveEvent(e){if(this._currentlyTouchDevice){const timeBetweenMousemoves=Date.now()-this._lastMousemoveEvent;this._lastMousemoveEvent=Date.now(),timeBetweenMousemoves>=3&&timeBetweenMousemoves<=50&&33!==timeBetweenMousemoves&&(this._currentlyTouchDevice=!1,this._slideShelf.classList.add("lapsa-hover"),this.slideContainer.classList.add("lapsa-hover"))}}fadeUpIn(element,duration){return new Promise(((resolve,reject)=>{element.style.marginTop=`${this._transitionAnimationDistance}px`,setTimeout((()=>{const oldTransitionStyle=element.style.transition;element.style.transition=`margin-top ${duration}ms ${this.slideAnimateInEasing}, opacity ${duration}ms ${this.slideAnimateInEasing}`,element.style.marginTop=0,element.style.opacity=1,setTimeout((()=>{element.style.transition=oldTransitionStyle,resolve()}),duration)}),16)}))}fadeUpOut(element,duration){return new Promise(((resolve,reject)=>{const oldTransitionStyle=element.style.transition;element.style.transition=`margin-top ${duration}ms ${this.slideAnimateOutEasing}, opacity ${duration}ms ${this.slideAnimateOutEasing}`,element.style.marginTop=-this._transitionAnimationDistance+"px",element.style.opacity=0,setTimeout((()=>{element.style.transition=oldTransitionStyle,resolve()}),duration)}))}fadeDownIn(element,duration){return new Promise(((resolve,reject)=>{element.style.marginTop=-this._transitionAnimationDistance+"px",setTimeout((()=>{const oldTransitionStyle=element.style.transition;element.style.transition=`margin-top ${duration}ms ${this.slideAnimateInEasing}, opacity ${duration}ms ${this.slideAnimateInEasing}`,element.style.marginTop=0,element.style.opacity=1,setTimeout((()=>{element.style.transition=oldTransitionStyle,resolve()}),duration)}),16)}))}fadeDownOut(element,duration){return new Promise(((resolve,reject)=>{const oldTransitionStyle=element.style.transition;element.style.transition=`margin-top ${duration}ms ${this.slideAnimateOutEasing}, opacity ${duration}ms ${this.slideAnimateOutEasing}`,element.style.marginTop=`${this._transitionAnimationDistance}px`,element.style.opacity=0,setTimeout((()=>{element.style.transition=oldTransitionStyle,resolve()}),duration)}))}}